
KNOWLEDGE_BASE = [
    {
        'chunk_id': 'kb_project_overview_contracts_mvp',
        'text': '''Этот проект — текстовый агент-аналитик госзакупок. В MVP агент умеет отвечать на вопросы
по контрактам через метод DaMIA API `/contracts?format=1`, нормализует ответ в плоские `records: list[dict]`,
считает метрики и формирует аналитический текстовый вывод.

Важно: агент разделяет две задачи:
1) получение фактов и чисел из API (данные);
2) объяснение правил и интерпретации (справка / база знаний).''',
        'metadata': {'topic': 'project_tech', 'section': 'overview'}
    },
    {
        'chunk_id': 'kb_damia_contracts_format1_is_aggregates',
        'text': '''Метод DaMIA API `/contracts?format=1` возвращает не список отдельных контрактов, а агрегированные данные.
Данные агрегируются по:
- субъекту анализа (`subject_inn`);
- году (`year`);
- этапу/статусу закупки (`status`);
- валюте (`currency`).

Кроме агрегатов, метод может возвращать агрегаты по контрагентам (заказчики/поставщики) с перечнем регномеров
контрактов (`reg_numbers`), которые используются как примеры/основания.''',
        'metadata': {'topic': 'project_tech', 'endpoint': '/contracts?format=1'}
    },
    {
        'chunk_id': 'kb_raw_json_structure_subject_year_status',
        'text': '''Сырой JSON ответа `/contracts?format=1` имеет вложенную структуру:

`subject_inn -> year -> status -> payload`

Где:
- верхний уровень — ключи ИНН субъекта анализа (как строки);
- второй уровень — годы (обычно строка 'YYYY', но может быть приведена к int);
- третий уровень — этап закупки (status), например: 'Подача заявок';
- `payload` содержит блоки 'Цена' и (опционально) 'Заказчики' / 'Поставщики'.''',
        'metadata': {'topic': 'project_tech', 'section': 'api_response_shape'}
    },
    {
        'chunk_id': 'kb_status_values_procurement_stage',
        'text': '''Поле `status` в нормализованных записях соответствует этапу закупки (ключу в сыром JSON).
Типовые значения этапов:

1) 'Подача заявок'
2) 'Работа комиссии'
3) 'Закупка завершена'
4) 'Закупка отменена'

Важно: метрики по статусам (`by_status`) считаются на основе total-строк и показывают,
как распределяются суммы/количество по этапам в рамках выбранных фильтров.''',
        'metadata': {'topic': 'project_tech', 'section': 'statuses'}
    },
    {
        'chunk_id': 'kb_record_type_total_definition',
        'text': '''Записи `record_type='total'` — это агрегаты по контрактам без детализации по контрагентам.
Они строятся из `payload['Цена']`, который является списком объектов (обычно по валютам).

Для каждой total-записи фиксируются:
- subject_inn
- year
- status
- currency (ВалютаКод)
- currency_name (ВалютаНаим)
- amount (Сумма)
- count (Количество)

В total-записях отсутствуют контрагенты:
- все `counterparty_* = None`
- `reg_numbers = []`''',
        'metadata': {'topic': 'project_tech', 'section': 'records_schema'}
    },
    {
        'chunk_id': 'kb_record_type_counterparty_definition',
        'text': '''Записи `record_type='counterparty'` — это агрегаты по контрагентам в конкретной роли.
Они строятся из списков:
- `payload['Заказчики']` → `counterparty_role='customer'`
- `payload['Поставщики']` → `counterparty_role='supplier'`

Каждая запись содержит:
- идентификаторы среза: subject_inn, year, status
- валюту и показатели: currency, amount, count
- данные контрагента: counterparty_inn, counterparty_name_full и др.
- `reg_numbers`: список регномеров контрактов, связанных с этим агрегатом.''',
        'metadata': {'topic': 'project_tech', 'section': 'records_schema'}
    },
    {
        'chunk_id': 'kb_counterparty_fields_full_list',
        'text': '''Нормализатор формирует для `record_type='counterparty'` следующие поля контрагента:

- counterparty_role: 'customer' или 'supplier'
- counterparty_inn
- counterparty_ogrn
- counterparty_name_full (НаимПолн)
- counterparty_name_short (НаимСокр)
- counterparty_address (АдресПолн)
- counterparty_head_fio (РукФИО)
- counterparty_head_innfl (РукИННФЛ)
- counterparty_phone (Телефон, может быть None)
- counterparty_email (Email, может быть None)

Важно: часть полей может отсутствовать в исходных данных, поэтому значения могут быть None.''',
        'metadata': {'topic': 'project_tech', 'section': 'records_schema'}
    },
    {
        'chunk_id': 'kb_counterparty_price_object_currency_rows',
        'text': '''В counterparty-блоках цена контрагента хранится не как список, а как объект по валютам:

`cp['Цена'] = { 'RUB': {'Сумма': ..., 'Количество': ...}, 'USD': {...} }`

Нормализатор разворачивает этот объект в несколько строк:
- по одной строке на каждую валюту,
- каждая строка получает `currency`, `amount`, `count`.

Если валют несколько, это нормально: агрегаты по контрагенту будут представлены несколькими строками.''',
        'metadata': {'topic': 'project_tech', 'section': 'currency_handling'}
    },
    {
        'chunk_id': 'kb_currency_name_rules_total_vs_counterparty',
        'text': '''Поле `currency_name` заполняется только для total-строк, потому что в total-блоке используется:
- currency = 'ВалютаКод'
- currency_name = 'ВалютаНаим'

Для counterparty-строк `currency_name` всегда None, так как в формате цены контрагента по валютам
название валюты не гарантировано. Поэтому для UI и аналитики ориентируемся на `currency` (код валюты).''',
        'metadata': {'topic': 'project_tech', 'section': 'currency_handling'}
    },
    {
        'chunk_id': 'kb_reg_numbers_meaning_and_usage',
        'text': '''`reg_numbers` — это список регномеров контрактов (поле 'РегНомера' у контрагента).
Он хранится только в `record_type='counterparty'`.

Как использовать `reg_numbers` в ответах:
- показывать несколько примеров (5–20) как "основания" или "примеры контрактов";
- не пытаться суммировать по `reg_numbers` (это идентификаторы, а не показатели);
- помнить, что `reg_numbers` — это не обязательно полный список всех контрактов, а список,
который пришёл в агрегате по контрагенту.''',
        'metadata': {'topic': 'project_tech', 'section': 'evidence'}
    },
    {
        'chunk_id': 'kb_metrics_totals_only_from_total_rows',
        'text': '''Правило расчёта метрик: totals считаются только по `record_type='total'`.

Это означает:
- общие суммы и количества по валютам (`summary_totals`) берутся только из total-строк;
- разрезы `by_year`, `by_status`, `year_status` также строятся только по total-строкам.

Причина: counterparty-строки содержат агрегаты по контрагентам и могут не совпадать с totals,
если в ответе представлены не все контрагенты или есть особенности агрегации.''',
        'metadata': {'topic': 'project_tech', 'section': 'metrics_rules'}
    },
    {
        'chunk_id': 'kb_metrics_top_counterparties_only_from_counterparty_rows',
        'text': '''Правило расчёта метрик: топ контрагентов считается только по `record_type='counterparty'`.

Топы строятся отдельно:
- `top_customers` по `counterparty_role='customer'`
- `top_suppliers` по `counterparty_role='supplier'`

При этом топы считаются по одной выбранной валюте (`main_currency`), чтобы не смешивать суммы разных валют
и не искажать рейтинг.''',
        'metadata': {'topic': 'project_tech', 'section': 'metrics_rules'}
    },
    {
        'chunk_id': 'kb_currency_no_mixing_rule',
        'text': '''В аналитике контрактов суммы разных валют нельзя складывать вместе.
Поэтому сводные итоги (`summary`) группируются по валюте:

`summary['by_currency'][currency] = {'amount': ..., 'count': ...}`

Если валют несколько, корректный вывод:
- показывать суммы отдельно по каждой валюте;
- для графиков и топов выбрать одну "главную" валюту (`main_currency`).''',
        'metadata': {'topic': 'project_tech', 'section': 'currency_rules'}
    },
    {
        'chunk_id': 'kb_main_currency_selection_rule',
        'text': '''Правило выбора `main_currency`:
- если среди валют есть 'RUB', то `main_currency = 'RUB'`;
- иначе выбирается первая валюта из списка доступных валют.

`main_currency` используется как рабочая валюта для:
- графиков `by_year`, `by_status`, `year_status`;
- топов заказчиков/поставщиков.

Если `main_currency` не определена (нет total-строк), графики и топы могут быть пустыми.''',
        'metadata': {'topic': 'project_tech', 'section': 'currency_rules'}
    },
    {
        'chunk_id': 'kb_role_filter_affects_only_counterparty_rows',
        'text': '''Фильтр `role` применяется только к строкам `record_type='counterparty'`.

Это означает:
- если role='customer' → отбрасываются counterparty-строки поставщиков, но total-строки остаются;
- если role='supplier' → отбрасываются counterparty-строки заказчиков, но total-строки остаются.

Так totals всегда отражают общий объём по контрактам, а топы/контрагенты — только по выбранной роли.''',
        'metadata': {'topic': 'project_tech', 'section': 'filters'}
    },
    {
        'chunk_id': 'kb_filters_supported_in_metrics_layer',
        'text': '''В слое метрик поддерживаются фильтры:
- subject_inn: ИНН субъекта анализа
- years: список лет (int)
- statuses: список статусов (строки этапов закупки)
- role: 'customer' или 'supplier' (влияет только на counterparty-строки)
- min_amount / max_amount: фильтрация по сумме (amount)

Фильтрация применяется к записям перед расчётом метрик, поэтому влияет на итоговые суммы, графики и топы.''',
        'metadata': {'topic': 'project_tech', 'section': 'filters'}
    },
    {
        'chunk_id': 'kb_typical_reason_totals_not_equal_top_sums',
        'text': '''Типовая ситуация: сумма по totals не совпадает с суммой по топам контрагентов.
Это не ошибка расчёта, а следствие структуры данных:

- totals считаются по total-строкам (агрегаты по статусам/годам);
- топы считаются по counterparty-строкам (агрегаты по контрагентам);
- у counterparty-строк могут быть отдельные валютные разрезы, неполные выборки или другие особенности.

Правильная интерпретация:
- totals — основной источник "общей суммы";
- топы — рейтинг контрагентов в рамках доступных агрегатов.''',
        'metadata': {'topic': 'project_tech', 'section': 'interpretation'}
    },
    {
        'chunk_id': 'kb_agent_routing_api_vs_rag_vs_both',
        'text': '''Агент принимает решение, как отвечать на запрос пользователя, по маршрутам:

- `api`: если нужны числовые данные (сумма, количество, топы, графики) → вызвать `/contracts?format=1`,
  нормализовать, посчитать метрики и сформировать ответ по метрикам.
- `rag`: если вопрос справочный (как устроены закупки, 44-ФЗ/223-ФЗ, что значит термин) → ответить по базе знаний.
- `both`: если нужны и цифры, и объяснение правил/интерпретации → сначала API+метрики, затем справка из RAG.
- `clarify`: если запрос явно про аналитику, но не хватает входных данных (например нет ИНН).''',
        'metadata': {'topic': 'project_tech', 'section': 'agent_routing'}
    },
    {
        'chunk_id': 'kb_rag_definition_and_purpose_in_project',
        'text': '''RAG (Retrieval-Augmented Generation) — подход, при котором модель получает ответ не только "из памяти",
а опирается на найденные фрагменты базы знаний (чанки), релевантные запросу.

В этом проекте RAG используется для:
- объяснения правил расчёта метрик и интерпретации данных;
- справки по полям records и структуре `/contracts?format=1`;
- ответов на вопросы про госзакупки (44-ФЗ/223-ФЗ, поставщик/заказчик, документы, жалобы).

RAG снижает риск "галлюцинаций" и делает ответы более стабильными и проверяемыми.''',
        'metadata': {'topic': 'project_tech', 'section': 'rag_basics'}
    },
    {
        'chunk_id': 'kb_topk_retrieval_why_it_matters',
        'text': '''При retrieval в RAG используется параметр `top_k` — сколько чанков базы знаний отдаётся модели.

Почему `top_k` важно:
- слишком маленькое `top_k` → не хватает контекста, ответ может быть неполным;
- слишком большое `top_k` → появляется шум, модель путается и хуже следует правилам.

Практика для MVP:
- обычно достаточно `top_k=3..6`;
- если вопрос узкий (про конкретное правило) — лучше меньше;
- если вопрос широкий (про процедуру закупки) — можно больше, но аккуратно.''',
        'metadata': {'topic': 'project_tech', 'section': 'rag_retrieval'}
    },
]

KNOWLEDGE_BASE += [
    {
        'chunk_id': 'kb_44fz_scope_and_purpose',
        'text': '''44-ФЗ (контрактная система) — это основной закон, который регулирует закупки товаров, работ и услуг
для обеспечения государственных и муниципальных нужд. В логике 44-ФЗ закупка — это формализованный процесс, где:
- заказчик обязан действовать по установленным правилам,
- поставщик подаёт заявку на участие,
- победитель определяется по процедуре,
- затем заключается и исполняется контракт.

Главная идея: обеспечить прозрачность, конкуренцию и эффективное расходование бюджетных средств.''',
        'metadata': {'topic': 'law_44fz', 'section': 'overview'}
    },
    {
        'chunk_id': 'kb_44fz_who_is_customer',
        'text': '''Заказчик в закупках по 44-ФЗ — это организация или орган власти, который закупает товары/работы/услуги
для государственных или муниципальных нужд. Заказчик:
- формирует потребность и планирует закупки,
- готовит документацию,
- размещает закупку в ЕИС и проводит процедуру,
- заключает контракт и контролирует исполнение.

Для поставщика важно понимать: заказчик связан требованиями 44-ФЗ и не может произвольно менять правила закупки.''',
        'metadata': {'topic': 'law_44fz', 'section': 'roles'}
    },
    {
        'chunk_id': 'kb_44fz_who_is_supplier',
        'text': '''Поставщик (участник закупки) — это лицо, которое подаёт заявку и предлагает выполнить поставку/работу/услугу.
Поставщиком может быть организация или ИП, а в некоторых случаях и физическое лицо (в зависимости от требований закупки).

Роль поставщика:
- найти закупку,
- проверить требования,
- подготовить и подать заявку,
- при победе заключить контракт,
- исполнить контракт и закрыть обязательства по документам и срокам.''',
        'metadata': {'topic': 'law_44fz', 'section': 'roles'}
    },
    {
        'chunk_id': 'kb_44fz_key_principles',
        'text': '''В закупках по 44-ФЗ часто выделяют ключевые принципы, которые проявляются на практике:
- открытость и прозрачность (публикации в ЕИС, понятные правила процедуры),
- конкуренция (участие нескольких поставщиков),
- равный доступ (нельзя создавать необоснованные барьеры),
- эффективность (рациональное расходование средств),
- контроль и ответственность.

Эти принципы важны для интерпретации спорных ситуаций: если требования выглядят избыточными,
поставщики часто рассматривают возможность обжалования.''',
        'metadata': {'topic': 'law_44fz', 'section': 'principles'}
    },
    {
        'chunk_id': 'kb_44fz_general_procurement_lifecycle',
        'text': '''Типовой жизненный цикл закупки по 44-ФЗ можно представить как цепочку:
1) планирование потребности,
2) подготовка документации и извещения,
3) размещение закупки (ЕИС/ЭТП),
4) подача заявок,
5) работа комиссии и определение победителя,
6) заключение контракта,
7) исполнение контракта,
8) приёмка и оплата,
9) контроль и возможные споры.

В аналитике контрактов чаще всего видны агрегаты уже по этапам закупки и итогам исполнения.''',
        'metadata': {'topic': 'law_44fz', 'section': 'lifecycle'}
    },
    {
        'chunk_id': 'kb_44fz_stages_in_project_status_mapping',
        'text': '''В данных проекта этап закупки отражается полем `status` (статус/этап в агрегатах контрактов).
Типовые этапы:
- 'Подача заявок'
- 'Работа комиссии'
- 'Закупка завершена'
- 'Закупка отменена'

Как интерпретировать:
- 'Подача заявок' и 'Работа комиссии' — закупка ещё не завершена, итоговый контракт может не быть заключён;
- 'Закупка завершена' — процедура завершилась, обычно означает переход к контракту/результату;
- 'Закупка отменена' — процедура не завершилась заключением контракта по стандартному сценарию.''',
        'metadata': {'topic': 'law_44fz', 'section': 'stages'}
    },
    {
        'chunk_id': 'kb_44fz_eis_and_etp_roles',
        'text': '''ЕИС (единая информационная система) — центральная точка публикации закупок и документов.
ЭТП (электронная торговая площадка) — место, где проходит подача заявок и действия участников.

Упрощённо:
- ЕИС = публикация и официальный источник информации о закупке;
- ЭТП = выполнение процедурных действий (подача заявки, торги, протоколы).

Для поставщика это означает: закупку обычно ищут в ЕИС, а участвуют через ЭТП с электронной подписью.''',
        'metadata': {'topic': 'law_44fz', 'section': 'infrastructure'}
    },
    {
        'chunk_id': 'kb_44fz_documentation_importance',
        'text': '''Документация закупки — ключевой набор условий, по которым оценивают заявки и исполняют контракт.
Для поставщика важно:
- внимательно читать требования к участнику и к товару/работе/услуге,
- проверять сроки подачи заявки и обеспечения,
- понимать критерии оценки (если процедура не чисто ценовая),
- заранее оценить риски исполнения (сроки, штрафы, объём, условия оплаты).

Ошибка новичков: подавать заявку без полного анализа документации и ограничений.''',
        'metadata': {'topic': 'law_44fz', 'section': 'documentation'}
    },
    {
        'chunk_id': 'kb_44fz_procurement_methods_high_level',
        'text': '''В 44-ФЗ используются разные способы определения поставщика (высокоуровнево):
- конкурентные процедуры (аукционы, конкурсы и др.),
- неконкурентные случаи (например закупка у единственного поставщика при наличии оснований).

Для поставщика важно понимать, что разные процедуры отличаются:
- составом заявки,
- логикой оценки,
- требованиями к обеспечению,
- сроками и этапами.

В аналитике контрактов метод процедуры может не быть отражён напрямую, но этапы закупки и результаты видны в статусах.''',
        'metadata': {'topic': 'law_44fz', 'section': 'methods'}
    },
    {
        'chunk_id': 'kb_44fz_bid_application_concept',
        'text': '''Заявка на участие — это набор сведений и документов, который поставщик подаёт через ЭТП.
В заявке обычно есть:
- сведения об участнике (реквизиты, декларации),
- согласие/описание предлагаемого товара или услуги,
- ценовое предложение (в зависимости от процедуры),
- документы, подтверждающие соответствие требованиям.

Ключевой риск: если заявка оформлена с ошибками или не соответствует требованиям,
комиссия может отклонить участника на этапе рассмотрения.''',
        'metadata': {'topic': 'law_44fz', 'section': 'applications'}
    },
    {
        'chunk_id': 'kb_44fz_commission_role',
        'text': '''Комиссия заказчика рассматривает заявки и принимает решения по допуску/отклонению участников,
а также определяет победителя по правилам процедуры.

Этап 'Работа комиссии' обычно означает:
- проверку документов,
- проверку соответствия требованиям,
- оценку предложений.

Для поставщика это важный этап, где критичны корректность заявки и соблюдение формальных требований.''',
        'metadata': {'topic': 'law_44fz', 'section': 'commission'}
    },
    {
        'chunk_id': 'kb_44fz_contract_signing_basics',
        'text': '''После определения победителя стороны переходят к заключению контракта.
Важные практические моменты:
- контракт заключается на условиях документации и предложения победителя,
- поставщик обязан подписать контракт в установленный срок,
- могут требоваться обеспечение исполнения контракта и дополнительные документы.

Если победитель уклоняется от заключения, возможны санкции и риски включения в реестры недобросовестных поставщиков.''',
        'metadata': {'topic': 'law_44fz', 'section': 'contract'}
    },
    {
        'chunk_id': 'kb_44fz_contract_execution_and_acceptance',
        'text': '''Исполнение контракта включает фактическую поставку товара/выполнение работ/оказание услуг,
а также документальное подтверждение исполнения:
- акты, накладные, отчёты,
- приёмка заказчиком,
- оплата по условиям контракта.

Практика: даже если поставка выполнена, ошибки в документах или нарушение сроков могут привести к штрафам,
неустойкам или спорам. Поэтому поставщик должен управлять сроками и качеством документов.''',
        'metadata': {'topic': 'law_44fz', 'section': 'contract'}
    },
    {
        'chunk_id': 'kb_44fz_security_bid_and_contract_meaning',
        'text': '''Обеспечение (заявки или исполнения контракта) — это финансовая гарантия добросовестности участника.
Смысл обеспечения:
- снизить риск срыва закупки и неисполнения обязательств,
- отсеять участников, которые не готовы исполнять контракт.

Для поставщика обеспечение — это нагрузка на оборотные средства и риск потерь при нарушениях,
поэтому важно заранее оценивать финансовую модель участия.''',
        'metadata': {'topic': 'law_44fz', 'section': 'security'}
    },
    {
        'chunk_id': 'kb_44fz_common_supplier_mistakes',
        'text': '''Типовые ошибки поставщиков при участии в закупках:
- не прочитали документацию до конца и пропустили обязательные требования;
- не проверили сроки подачи заявки и обеспечения;
- загрузили неверные документы или не те форматы;
- неверно рассчитали цену (демпинг без учёта себестоимости и рисков);
- не учли условия поставки/логистики/гарантий.

В результате участника отклоняют на комиссии или контракт становится убыточным и рискованным.''',
        'metadata': {'topic': 'law_44fz', 'section': 'practice'}
    },
    {
        'chunk_id': 'kb_44fz_why_procurement_cancelled',
        'text': '''Статус 'Закупка отменена' может возникать по разным причинам:
- заказчик отменил процедуру из-за изменения потребности или ошибок в документации;
- закупка признана несостоявшейся (например, недостаточно заявок);
- выявлены нарушения и закупку отменили по результатам контроля.

Для аналитики важно: отменённые закупки не равны завершённым контрактам,
поэтому при оценке объёма рынка часто анализируют отдельно завершённые и отменённые процедуры.''',
        'metadata': {'topic': 'law_44fz', 'section': 'stages'}
    },
    {
        'chunk_id': 'kb_44fz_data_interpretation_link_to_contracts_metrics',
        'text': '''Если агент анализирует контракты по `/contracts?format=1`, то суммы и количество по статусам
помогают понять распределение по этапам.

Пример интерпретации:
- рост суммы в 'Подача заявок' может означать активный текущий поток закупок;
- высокий объём в 'Закупка завершена' отражает завершённые процедуры (часто ближе к фактическим контрактам);
- заметная доля 'Закупка отменена' может указывать на нестабильность планирования или проблемы с документацией.

При выводах важно учитывать валюту и не смешивать суммы разных валют.''',
        'metadata': {'topic': 'law_44fz', 'section': 'analytics_interpretation'}
    },
    {
        'chunk_id': 'kb_44fz_supplier_strategy_basic',
        'text': '''Базовая стратегия поставщика для стабильного участия:
1) выбрать подходящие категории закупок (по отрасли и объёму),
2) подготовить пакет документов заранее (чтобы не делать это в последний день),
3) вести календарь сроков по заявкам и обеспечению,
4) оценивать рентабельность и риски исполнения,
5) аккуратно участвовать в первых закупках, чтобы набрать опыт без больших потерь.

Даже при хорошем знании закона успех участия часто зависит от дисциплины и качества подготовки заявки.''',
        'metadata': {'topic': 'law_44fz', 'section': 'practice'}
    },
]

KNOWLEDGE_BASE += [
    {
        'chunk_id': 'kb_223fz_scope_and_role',
        'text': '''223-ФЗ регулирует закупки отдельных видов юридических лиц, а не всех госзаказчиков подряд.
По 223-ФЗ закупаются, например:
- государственные корпорации и компании с госучастием,
- естественные монополии,
- отдельные крупные хозяйственные общества.

В отличие от 44-ФЗ, 223-ФЗ задаёт рамки, а конкретные правила закупки
устанавливаются самим заказчиком в его "положении о закупке".''',
        'metadata': {'topic': 'law_223fz', 'section': 'overview'}
    },
    {
        'chunk_id': 'kb_223fz_main_difference_from_44fz',
        'text': '''Ключевое отличие 223-ФЗ от 44-ФЗ — уровень формализации:
- 44-ФЗ строго регламентирует процедуры и этапы;
- 223-ФЗ позволяет заказчику самостоятельно описывать правила в положении о закупке.

Для поставщика это означает:
- меньше универсальных шаблонов,
- больше необходимости читать документацию каждой конкретной закупки,
- выше вариативность требований и процедур.''',
        'metadata': {'topic': 'law_223fz', 'section': 'comparison'}
    },
    {
        'chunk_id': 'kb_223fz_position_on_procurement',
        'text': '''Положение о закупке — ключевой документ заказчика по 223-ФЗ.
В нём описываются:
- способы закупки,
- требования к участникам,
- порядок подачи и рассмотрения заявок,
- критерии оценки,
- порядок заключения и исполнения договоров.

Без изучения положения о закупке невозможно корректно оценить правила конкретной процедуры.''',
        'metadata': {'topic': 'law_223fz', 'section': 'documentation'}
    },
    {
        'chunk_id': 'kb_223fz_flexibility_and_risks',
        'text': '''Гибкость 223-ФЗ имеет две стороны:
- плюс для заказчика — возможность адаптировать закупки под свои нужды;
- риск для поставщика — правила могут существенно отличаться от привычных по 44-ФЗ.

Практика показывает: в закупках по 223-ФЗ чаще встречаются нестандартные требования,
поэтому поставщику важно закладывать дополнительное время на анализ документации.''',
        'metadata': {'topic': 'law_223fz', 'section': 'practice'}
    },
    {
        'chunk_id': 'kb_223fz_procurement_methods_variety',
        'text': '''В рамках 223-ФЗ заказчик может использовать широкий набор процедур:
- конкурсы,
- аукционы,
- запросы предложений,
- закупки у единственного поставщика,
- иные формы, описанные в положении о закупке.

Название процедуры не всегда отражает её реальную механику,
поэтому ориентироваться нужно на описание этапов и требований в документации.''',
        'metadata': {'topic': 'law_223fz', 'section': 'methods'}
    },
    {
        'chunk_id': 'kb_223fz_supplier_requirements_variability',
        'text': '''Требования к участникам по 223-ФЗ могут значительно различаться:
- финансовые показатели,
- опыт исполнения аналогичных договоров,
- наличие лицензий и сертификатов,
- специальные формы документов.

Для поставщика это означает: нельзя механически переносить опыт одной закупки на другую,
даже если заказчик похожий или из той же отрасли.''',
        'metadata': {'topic': 'law_223fz', 'section': 'requirements'}
    },
    {
        'chunk_id': 'kb_223fz_application_logic',
        'text': '''Заявка по 223-ФЗ подаётся через ЭТП, но её структура и состав документов
определяются положением о закупке и документацией.

Часто встречаются:
- многочастные заявки,
- отдельные технические и коммерческие предложения,
- дополнительные формы заказчика.

Ошибки в структуре заявки — одна из частых причин отклонения.''',
        'metadata': {'topic': 'law_223fz', 'section': 'applications'}
    },
    {
        'chunk_id': 'kb_223fz_evaluation_criteria',
        'text': '''В закупках по 223-ФЗ критерии оценки могут быть не только ценовыми.
Возможны:
- балльные оценки,
- весовые коэффициенты,
- качественные критерии,
- комбинированные модели.

Для поставщика важно заранее понять:
- что именно влияет на итоговый рейтинг,
- какие документы подтверждают соответствие критериям.''',
        'metadata': {'topic': 'law_223fz', 'section': 'evaluation'}
    },
    {
        'chunk_id': 'kb_223fz_commission_and_decisions',
        'text': '''Комиссия заказчика по 223-ФЗ действует в рамках положения о закупке.
Решения комиссии должны соответствовать установленным правилам,
но степень формализации ниже, чем по 44-ФЗ.

Это повышает значение:
- корректности оформления заявки,
- аргументации соответствия требованиям,
- готовности к обжалованию при спорных ситуациях.''',
        'metadata': {'topic': 'law_223fz', 'section': 'commission'}
    },
    {
        'chunk_id': 'kb_223fz_contract_concept',
        'text': '''По итогам закупки по 223-ФЗ заключается договор, а не "контракт" в терминологии 44-ФЗ.
Условия договора формируются на основе документации и предложения победителя.

Для поставщика важно:
- внимательно проверить проект договора,
- оценить условия ответственности, штрафов и неустоек,
- понять порядок изменения и расторжения договора.''',
        'metadata': {'topic': 'law_223fz', 'section': 'contract'}
    },
    {
        'chunk_id': 'kb_223fz_execution_and_control',
        'text': '''Исполнение договора по 223-ФЗ регулируется условиями самого договора
и внутренними регламентами заказчика.

Контроль может быть менее формализован, чем по 44-ФЗ,
но это не означает отсутствия рисков: нарушения сроков и условий
также могут привести к санкциям и ухудшению репутации поставщика.''',
        'metadata': {'topic': 'law_223fz', 'section': 'execution'}
    },
    {
        'chunk_id': 'kb_223fz_complaints_possibility',
        'text': '''Закупки по 223-ФЗ также могут быть обжалованы,
но порядок и основания обжалования зависят от законодательства и практики ФАС.

Поставщику важно:
- понимать, какие действия заказчика можно оспаривать,
- учитывать сроки подачи жалоб,
- соотносить затраты на обжалование с потенциальной выгодой.''',
        'metadata': {'topic': 'law_223fz', 'section': 'control'}
    },
    {
        'chunk_id': 'kb_223fz_supplier_risk_assessment',
        'text': '''Риски поставщика в закупках по 223-ФЗ часто связаны с:
- нестандартными требованиями,
- индивидуальными условиями договоров,
- ограниченной возможностью обжалования.

Практический совет: для новых заказчиков по 223-ФЗ начинать с небольших по объёму закупок,
чтобы понять их практику и снизить потенциальные потери.''',
        'metadata': {'topic': 'law_223fz', 'section': 'risks'}
    },
    {
        'chunk_id': 'kb_223fz_data_interpretation_in_contracts_metrics',
        'text': '''В агрегированных данных контрактов закупки по 223-ФЗ
могут выглядеть иначе, чем по 44-ФЗ:
- больше вариативности статусов,
- различия в структуре контрагентов,
- нестабильность объёмов по годам.

При анализе важно учитывать тип заказчика и не сравнивать напрямую
показатели 223-ФЗ с 44-ФЗ без контекста.''',
        'metadata': {'topic': 'law_223fz', 'section': 'analytics_interpretation'}
    },
    {
        'chunk_id': 'kb_223fz_strategy_for_supplier',
        'text': '''Базовая стратегия поставщика по 223-ФЗ:
- тщательно читать положение о закупке,
- анализировать проект договора до подачи заявки,
- оценивать не только цену, но и риски исполнения,
- учитывать репутационные последствия для будущих закупок.

В отличие от 44-ФЗ, здесь меньше шаблонов и больше индивидуальных решений.''',
        'metadata': {'topic': 'law_223fz', 'section': 'practice'}
    },
    {
        'chunk_id': 'kb_223fz_common_mistakes',
        'text': '''Типовые ошибки поставщиков в закупках по 223-ФЗ:
- игнорирование положения о закупке,
- перенос логики 44-ФЗ без адаптации,
- недооценка условий договора,
- формальный подход к подготовке заявки.

Эти ошибки часто приводят к отклонению заявки или к убыточному договору.''',
        'metadata': {'topic': 'law_223fz', 'section': 'practice'}
    },
    {
        'chunk_id': 'kb_223fz_customer_perspective',
        'text': '''С точки зрения заказчика, 223-ФЗ позволяет:
- гибко формировать закупочные процедуры,
- быстрее адаптироваться к рынку,
- учитывать специфику деятельности.

Это объясняет, почему правила закупок по 223-ФЗ могут существенно отличаться
даже у заказчиков одной отрасли.''',
        'metadata': {'topic': 'law_223fz', 'section': 'customer_view'}
    },
    {
        'chunk_id': 'kb_223fz_link_to_agent_answers',
        'text': '''Когда агент отвечает на вопросы по закупкам 223-ФЗ,
он использует базу знаний для объяснения:
- почему правила конкретной закупки нестандартны,
- почему требования отличаются от 44-ФЗ,
- какие риски следует учитывать поставщику.

Числовая аналитика контрактов дополняется этим контекстом,
чтобы пользователь не делал ошибочных выводов.''',
        'metadata': {'topic': 'law_223fz', 'section': 'agent_usage'}
    },
]

KNOWLEDGE_BASE += [
    {
        'chunk_id': 'kb_supplier_start_goal',
        'text': '''Участие поставщика в госзакупках можно рассматривать как управляемый процесс.
Цель поставщика — не просто выиграть тендер, а:
- выиграть контракт, который реально можно исполнить,
- получить оплату без конфликтов,
- сохранить репутацию и возможность участвовать дальше.

Поэтому участие всегда включает два слоя:
1) формальные действия (регистрация, документы, подача заявки);
2) управленческие решения (оценка рисков, цены, ресурсов).''',
        'metadata': {'topic': 'supplier_guide', 'section': 'overview', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_ukep_why_needed',
        'text': '''УКЭП (усиленная квалифицированная электронная подпись) — ключевой инструмент поставщика
для участия в электронных закупках. Она используется для:
- регистрации и работы в ЕИС,
- подачи заявок на ЭТП,
- подписания документов,
- подписания контрактов/договоров.

Без электронной подписи поставщик фактически не может участвовать в большинстве процедур,
так как процесс полностью электронный.''',
        'metadata': {'topic': 'supplier_guide', 'section': 'ukep', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_eis_eruz_etp_relationship',
        'text': '''ЕИС, ЕРУЗ и ЭТП — связанные элементы инфраструктуры закупок:

- ЕИС: портал, где публикуются закупки и документы.
- ЕРУЗ: реестр участников закупок (данные поставщика).
- ЭТП: площадка, где выполняются действия по участию (подача заявки, торги, протоколы).

Практическая логика:
сначала поставщик регистрируется в системе, затем участвует в закупках через площадки,
используя одни и те же учётные данные и электронную подпись.''',
        'metadata': {'topic': 'supplier_guide', 'section': 'infrastructure', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_profile_data_quality',
        'text': '''Качество профиля поставщика (реквизиты, контакты, документы) влияет на участие в закупках.
Если данные в реестрах неполные или устаревшие, возможны проблемы:
- ошибки при формировании заявки,
- отклонение по формальным основаниям,
- невозможность подписать контракт вовремя.

Рекомендация: поддерживать данные компании в актуальном состоянии и заранее проверять,
что все обязательные сведения корректны.''',
        'metadata': {'topic': 'supplier_guide', 'section': 'profile', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_search_procurements',
        'text': '''Поиск закупок — это регулярная задача поставщика.
Обычно поставщик:
- ищет закупки в ЕИС по ключевым словам, кодам, регионам и цене,
- сохраняет фильтры и отслеживает новые публикации,
- оценивает релевантность закупки по предмету, срокам и объёму.

Практика: эффективнее вести "воронку закупок", где часть закупок отсеивается на этапе быстрой проверки,
а часть переходит в глубокий анализ документации.''',
        'metadata': {'topic': 'supplier_guide', 'section': 'search', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_reading_documentation_checklist',
        'text': '''Перед подачей заявки поставщик должен прочитать документацию и проверить минимум:
- предмет закупки и объём,
- требования к участнику (лицензии, опыт, допуски),
- требования к товару/работе/услуге (ТЗ),
- сроки поставки/исполнения,
- условия оплаты,
- необходимость обеспечения заявки/контракта,
- критерии оценки (если не только цена),
- штрафы, неустойки, ответственность.

Это снижает риск участия в убыточных или невыполнимых закупках.''',
        'metadata': {'topic': 'supplier_guide', 'section': 'documentation', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_application_structure_general',
        'text': '''Заявка на участие в закупке — это структурированный пакет сведений.
В общем виде она включает:
- сведения о поставщике (реквизиты, декларации),
- подтверждающие документы (по требованиям закупки),
- техническое предложение (что именно поставляется/как выполняется),
- коммерческое предложение (цена, условия, если требуется).

Даже если закупка кажется простой, ошибки в заявке могут привести к отклонению на комиссии.''',
        'metadata': {'topic': 'supplier_guide', 'section': 'application', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_documents_basic_set',
        'text': '''Базовый набор документов поставщика часто включает:
- регистрационные сведения организации (ИНН, ОГРН, адрес),
- банковские реквизиты,
- документы о полномочиях подписанта (при необходимости),
- декларации соответствия требованиям,
- лицензии и сертификаты (если требуются),
- документы по опыту и квалификации (если оценивается опыт).

Точный перечень зависит от закупки и её документации, поэтому универсального набора "на все случаи" нет.''',
        'metadata': {'topic': 'supplier_guide', 'section': 'documents', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_deadlines_and_planning',
        'text': '''Сроки — критический фактор участия.
Поставщик должен контролировать:
- дату и время окончания подачи заявок,
- сроки внесения обеспечения (если требуется),
- сроки предоставления разъяснений и запросов,
- сроки подписания контракта при победе.

Практика: участие в закупках требует дисциплины и календарного планирования,
иначе даже хорошая заявка может быть подана поздно или с нарушением регламента.''',
        'metadata': {'topic': 'supplier_guide', 'section': 'deadlines', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_special_account_and_cashflow',
        'text': '''Финансовая готовность поставщика включает:
- наличие средств на обеспечение заявки или контракта (если требуется),
- управление оборотными средствами,
- понимание сроков оплаты и кассовых разрывов.

Даже прибыльный контракт может стать проблемой, если:
- оплата по контракту отсрочена,
- требуется значительное обеспечение,
- поставщик не рассчитает нагрузку на оборотные средства.''',
        'metadata': {'topic': 'supplier_guide', 'section': 'finance', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_pricing_and_margin_risk',
        'text': '''Ценообразование в закупках — это не только "поставить минимальную цену".
Поставщик должен учитывать:
- себестоимость,
- логистику,
- налоги,
- гарантийные обязательства,
- штрафы и риски срыва сроков,
- стоимость обеспечения.

Ошибочная стратегия демпинга приводит к выигрышу убыточного контракта и повышает риск неисполнения.''',
        'metadata': {'topic': 'supplier_guide', 'section': 'pricing', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_submission_on_etp',
        'text': '''Подача заявки происходит через электронную торговую площадку (ЭТП).
Типовая логика:
1) выбрать закупку на ЭТП,
2) заполнить форму заявки,
3) прикрепить документы,
4) подписать электронной подписью,
5) отправить заявку до дедлайна.

После подачи важно сохранить подтверждение отправки и проверять статус заявки в системе,
так как технические ошибки или неверные форматы файлов могут привести к проблемам.''',
        'metadata': {'topic': 'supplier_guide', 'section': 'submission', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_questions_and_clarifications',
        'text': '''Если в документации есть неоднозначности, поставщик может:
- запросить разъяснения (если предусмотрено процедурой),
- уточнить технические параметры,
- уточнить порядок подтверждения требований.

Смысл разъяснений:
- снизить риск отклонения заявки,
- понять реальные ожидания заказчика,
- избежать ошибок в техническом предложении.

Важно: вопросы задаются в установленные сроки и в установленной форме.''',
        'metadata': {'topic': 'supplier_guide', 'section': 'clarifications', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_commission_stage_how_to_pass',
        'text': '''Этап рассмотрения заявок (работа комиссии) критичен для прохождения.
Чтобы минимизировать риск отклонения:
- строго следовать требованиям документации,
- проверять комплектность документов,
- избегать противоречий в заявке,
- внимательно заполнять формы ЭТП.

Часто отклоняют не за "качество товара", а за формальные несоответствия или ошибки в документах.''',
        'metadata': {'topic': 'supplier_guide', 'section': 'commission', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_win_and_contract_signing',
        'text': '''Если поставщик победил, начинается этап заключения контракта.
Поставщику важно:
- подписать контракт в срок,
- предоставить обеспечение исполнения (если требуется),
- подготовить документы для исполнения (логистика, склад, персонал).

Срыв сроков подписания или уклонение от заключения — один из самых опасных сценариев,
который может привести к серьёзным санкциям и ограничениям на участие в будущем.''',
        'metadata': {'topic': 'supplier_guide', 'section': 'contract', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_execution_management',
        'text': '''Исполнение контракта требует операционного управления:
- соблюдение сроков поставки,
- контроль качества,
- корректные закрывающие документы,
- коммуникация с заказчиком по приёмке.

Даже если поставщик "всё сделал", ошибки в документах или несогласованность по приёмке
могут затянуть оплату и привести к конфликтам. Поэтому важна дисциплина документооборота.''',
        'metadata': {'topic': 'supplier_guide', 'section': 'execution', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_reputation_and_repeat_business',
        'text': '''Репутация поставщика в закупках формируется через:
- качество исполнения,
- соблюдение сроков,
- отсутствие конфликтов и срывов.

Практика: заказчики и рынок запоминают надёжных поставщиков,
а проблемы с исполнением могут снижать шансы на будущие победы.
Поэтому стратегия "выиграть любой ценой" часто проигрывает стратегии "выигрывать то, что можешь исполнить".''',
        'metadata': {'topic': 'supplier_guide', 'section': 'reputation', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_supplier_common_failures',
        'text': '''Типовые провалы поставщика в закупках:
- участие без расчёта ресурсов (не хватает людей/техники/товара),
- неверное понимание ТЗ,
- недооценка штрафов и сроков,
- ошибки в заявке и отклонение на комиссии,
- победа в убыточной закупке,
- уклонение от подписания контракта.

Аналитика контрактов помогает выявлять такие риски косвенно:
например, высокая доля отменённых закупок или нестабильность по статусам.''',
        'metadata': {'topic': 'supplier_guide', 'section': 'risks', 'role': 'supplier'}
    },
]

KNOWLEDGE_BASE += [
    {
        'chunk_id': 'kb_customer_role_overview',
        'text': '''Заказчик в госзакупках — это сторона, которая формирует потребность и закупает товары/работы/услуги.
С точки зрения процесса заказчик отвечает за:
- корректное планирование,
- подготовку документации,
- проведение процедуры,
- выбор победителя,
- заключение и исполнение контракта,
- контроль и отчётность.

Понимание логики заказчика помогает поставщику лучше читать документацию и прогнозировать риски.''',
        'metadata': {'topic': 'customer_guide', 'section': 'overview', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_planning_importance',
        'text': '''Планирование закупок — базовый этап, который влияет на весь цикл.
На этапе планирования заказчик определяет:
- что именно нужно купить,
- в какие сроки,
- с каким бюджетом,
- какие требования к результату.

Ошибки планирования приводят к:
- отменам закупок,
- изменению условий на ходу,
- конфликтам при исполнении.
Для аналитики контрактов это может проявляться ростом доли статуса 'Закупка отменена'.''',
        'metadata': {'topic': 'customer_guide', 'section': 'planning', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_terms_of_reference_tz',
        'text': '''Техническое задание (ТЗ) или описание объекта закупки — ключевой документ, который определяет:
- характеристики товара/работы/услуги,
- требования к качеству,
- объём и сроки,
- условия приёмки.

Для поставщика ТЗ — главный источник понимания, сможет ли он реально исполнить контракт.
Для заказчика качество ТЗ определяет, насколько закупка будет конкурентной и выполнимой.''',
        'metadata': {'topic': 'customer_guide', 'section': 'documentation', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_requirements_to_participants',
        'text': '''Заказчик устанавливает требования к участникам закупки.
Требования могут включать:
- наличие лицензий,
- наличие опыта,
- финансовую устойчивость,
- наличие ресурсов и квалификации.

Риск для заказчика: чрезмерные или некорректные требования могут снизить конкуренцию
и привести к жалобам или отмене процедуры.
Риск для поставщика: несоответствие требованиям ведёт к отклонению заявки.''',
        'metadata': {'topic': 'customer_guide', 'section': 'requirements', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_publication_in_eis',
        'text': '''Публикация закупки в ЕИС — момент, когда закупка становится публичной.
Заказчик размещает:
- извещение,
- документацию,
- проект контракта,
- сроки подачи заявок,
- требования и критерии.

Для поставщика это точка входа: именно по этим документам принимается решение участвовать или нет.
Для заказчика важно, чтобы публикация была корректной, иначе возможны жалобы и отмена.''',
        'metadata': {'topic': 'customer_guide', 'section': 'eis', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_application_receiving_stage',
        'text': '''Этап 'Подача заявок' — период, когда поставщики подают заявки через ЭТП.
С точки зрения заказчика это этап ожидания и подготовки к рассмотрению.

Практика:
- заказчик должен обеспечить корректность процедуры,
- отвечать на разъяснения (если предусмотрено),
- не менять правила вне установленных механизмов.

Для аналитики: рост сумм в статусе 'Подача заявок' отражает активный текущий поток закупок.''',
        'metadata': {'topic': 'customer_guide', 'section': 'stages', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_commission_work_stage',
        'text': '''Этап 'Работа комиссии' — рассмотрение заявок и принятие решений.
Комиссия:
- проверяет соответствие требованиям,
- анализирует документы,
- оценивает предложения по правилам закупки,
- формирует протоколы.

Ошибки комиссии (или неоднозначные требования) могут привести к жалобам и отмене результатов.
Для поставщика это этап, где важно соблюдение формальных требований заявки.''',
        'metadata': {'topic': 'customer_guide', 'section': 'commission', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_protocols_meaning',
        'text': '''Протоколы — официальная фиксация решений комиссии и этапов процедуры.
Протоколы важны потому что:
- подтверждают легитимность решений,
- используются при обжаловании,
- определяют победителя и основания отклонения.

Для поставщика протоколы помогают понять, почему его заявку отклонили или почему победил другой участник.
Для заказчика протоколы — элемент юридической защиты решений.''',
        'metadata': {'topic': 'customer_guide', 'section': 'protocols', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_winner_selection_logic',
        'text': '''Выбор победителя зависит от процедуры и критериев.
В простых процедурах доминирует цена, но могут учитываться и другие критерии:
- качество,
- сроки,
- опыт,
- квалификация.

Заказчик обязан следовать опубликованным правилам.
Если критерии применяются не так, как заявлено в документации,
это повышает риск жалоб и признания результатов недействительными.''',
        'metadata': {'topic': 'customer_guide', 'section': 'evaluation', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_contract_signing_process',
        'text': '''После определения победителя заказчик заключает контракт.
На этом этапе важно:
- соблюдение сроков подписания,
- получение обеспечения исполнения (если предусмотрено),
- корректность условий контракта.

Если победитель уклоняется, заказчик может столкнуться с задержкой исполнения потребности
и необходимостью повторной закупки.
В аналитике это может проявляться ростом незавершённых статусов или повторяющихся процедур.''',
        'metadata': {'topic': 'customer_guide', 'section': 'contract', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_contract_execution_control',
        'text': '''Контроль исполнения контракта — зона ответственности заказчика.
Он включает:
- контроль сроков поставки/работ,
- приёмку результатов,
- проверку качества,
- оформление закрывающих документов,
- проведение оплаты.

Для заказчика важно не допустить приёмку некачественного результата,
а для поставщика важно предоставить документы без ошибок, чтобы избежать задержек оплаты.''',
        'metadata': {'topic': 'customer_guide', 'section': 'execution', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_acceptance_risks',
        'text': '''Приёмка — один из самых конфликтных этапов.
Риски:
- поставщик считает, что всё поставлено, а заказчик видит несоответствие ТЗ;
- документы оформлены неправильно;
- спор по срокам и объёму.

Чтобы снизить риски:
- заказчик должен иметь чёткое ТЗ и критерии приёмки,
- поставщик должен заранее согласовывать спорные моменты и вести документооборот дисциплинированно.''',
        'metadata': {'topic': 'customer_guide', 'section': 'acceptance', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_payment_and_delays',
        'text': '''Оплата по контракту зависит от условий контракта и корректности документов.
Задержки оплаты могут возникать из-за:
- ошибок в закрывающих документах,
- несоответствия результата требованиям,
- внутренней бюрократии заказчика.

Для поставщика это финансовый риск (кассовый разрыв).
Для заказчика — риск конфликтов и ухудшения качества исполнения.
Поэтому обе стороны заинтересованы в корректной документации.''',
        'metadata': {'topic': 'customer_guide', 'section': 'payment', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_why_procurement_cancelled',
        'text': '''Причины отмены закупки со стороны заказчика могут быть разные:
- изменение потребности или бюджета,
- выявленные ошибки в документации,
- необходимость изменить требования,
- недостаточная конкуренция,
- результаты контроля или жалобы.

Статус 'Закупка отменена' в аналитике — сигнал:
процедуры не доходят до завершения, и рынок может быть нестабильным или перегретым требованиями.''',
        'metadata': {'topic': 'customer_guide', 'section': 'cancellation', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_unsuccessful_procurement_case',
        'text': '''Закупка может быть признана несостоявшейся, если:
- нет заявок,
- заявок недостаточно,
- все заявки отклонены.

Для заказчика это означает потерю времени и необходимость повторной закупки или изменения условий.
Для поставщика это может быть сигналом, что:
- требования слишком жёсткие,
- рынок не готов,
- цена/условия неинтересны участникам.''',
        'metadata': {'topic': 'customer_guide', 'section': 'competition', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_balance_competition_and_quality',
        'text': '''Заказчик всегда балансирует между:
- желанием получить качество и минимизировать риски,
- необходимостью обеспечить конкуренцию и соблюдение принципов закупок.

Слишком мягкие требования повышают риск получить слабого исполнителя.
Слишком жёсткие требования снижают конкуренцию и увеличивают риск жалоб.

Поставщик, понимающий эту логику, может лучше формировать предложение и избегать конфликтов.''',
        'metadata': {'topic': 'customer_guide', 'section': 'strategy', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_interpretation_for_contracts_analytics',
        'text': '''Если анализировать контракты по `/contracts?format=1`, то для заказчика полезны выводы:
- динамика по годам показывает изменение объёма закупок,
- распределение по статусам показывает текущий портфель закупок,
- топ поставщиков помогает оценить концентрацию и зависимость от ключевых исполнителей.

При этом важно помнить: суммы считаются отдельно по валютам, а графики строятся по `main_currency`.''',
        'metadata': {'topic': 'customer_guide', 'section': 'analytics_interpretation', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_typical_optimization_actions',
        'text': '''Типовые действия заказчика для улучшения закупок:
- улучшение качества ТЗ,
- снижение неопределённости требований,
- адекватное планирование сроков,
- повышение прозрачности критериев оценки,
- анализ истории закупок и поставщиков.

Аналитика контрактов помогает выявлять узкие места:
например, рост отмен или падение конкуренции по конкретным категориям закупок.''',
        'metadata': {'topic': 'customer_guide', 'section': 'improvement', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_customer_common_errors',
        'text': '''Типовые ошибки заказчиков:
- неясное или противоречивое ТЗ,
- требования, которые сложно подтвердить документально,
- ошибки в документации и сроках,
- слабая подготовка комиссии,
- недостаточный контроль исполнения.

Для поставщика такие ошибки повышают риск конфликтов и неопределённости.
Для аналитики они могут проявляться в нестабильности статусов и высокой доле отменённых процедур.''',
        'metadata': {'topic': 'customer_guide', 'section': 'risks', 'role': 'customer'}
    },
]

KNOWLEDGE_BASE += [
    {
        'chunk_id': 'kb_control_overview_why_exists',
        'text': '''Контроль в госзакупках нужен для защиты конкуренции и соблюдения правил.
Он снижает риски:
- коррупционных схем,
- дискриминации участников,
- нарушения процедур,
- неэффективного расходования средств.

Для поставщика контроль — это возможность защищать свои права через жалобы.
Для заказчика контроль — это обязательная среда, где ошибки в документации и процедуре могут привести к отменам.''',
        'metadata': {'topic': 'control_and_risks', 'section': 'overview'}
    },
    {
        'chunk_id': 'kb_fas_role_in_procurement',
        'text': '''ФАС (Федеральная антимонопольная служба) — ключевой орган контроля конкуренции.
В контексте закупок ФАС рассматривает жалобы участников на нарушения процедуры,
оценивает корректность требований и действий заказчика, и может влиять на результаты закупки.

Практический смысл для поставщика:
ФАС — один из основных инструментов защиты от неправомерных требований и решений комиссии.''',
        'metadata': {'topic': 'control_and_risks', 'section': 'fas'}
    },
    {
        'chunk_id': 'kb_when_supplier_files_complaint',
        'text': '''Поставщик подаёт жалобу, когда считает, что его права нарушены, например:
- требования в документации ограничивают конкуренцию без основания,
- комиссия отклонила заявку неправомерно,
- заказчик нарушил порядок рассмотрения заявок,
- результаты закупки вызывают сомнения в законности.

Жалоба — это не "конфликт ради конфликта", а инструмент защиты экономического интереса,
если нарушение реально повлияло на возможность победы.''',
        'metadata': {'topic': 'control_and_risks', 'section': 'complaints', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_when_customer_faces_complaint',
        'text': '''Заказчик сталкивается с жалобами, когда:
- документация содержит спорные требования,
- процедура проведена с нарушениями,
- комиссия допустила формальные ошибки,
- участники считают, что их отклонили неправомерно.

Для заказчика жалоба — это риск:
- приостановки процедуры,
- необходимости исправлять документацию,
- репутационных потерь,
- отмены результатов закупки.''',
        'metadata': {'topic': 'control_and_risks', 'section': 'complaints', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_complaint_effects_on_procurement_status',
        'text': '''Жалобы и контрольные мероприятия могут влиять на ход закупки.
В данных это может проявляться как:
- рост доли статуса 'Закупка отменена',
- зависание объёма в статусах 'Подача заявок' или 'Работа комиссии',
- повторные закупки после отмены.

Поэтому при аналитике по статусам важно помнить:
отмена — не всегда "ошибка рынка", иногда это следствие контроля или корректировки процедуры.''',
        'metadata': {'topic': 'control_and_risks', 'section': 'analytics_interpretation'}
    },
    {
        'chunk_id': 'kb_rnp_definition_and_risk',
        'text': '''РНП (реестр недобросовестных поставщиков) — это механизм ограничения участников,
которые нарушили ключевые обязательства (например, уклонились от заключения контракта
или существенно нарушили условия исполнения).

Для поставщика попадание в РНП — серьёзный риск, так как это может ограничить участие в закупках
и повлиять на репутацию. Поэтому после победы особенно важно соблюдать сроки подписания и исполнения.''',
        'metadata': {'topic': 'control_and_risks', 'section': 'rnp'}
    },
    {
        'chunk_id': 'kb_supplier_avoid_rnp_practical',
        'text': '''Чтобы снизить риск попадания в РНП, поставщику важно:
- участвовать только в тех закупках, которые реально можно исполнить,
- заранее проверять ресурсы и сроки,
- не демпинговать до уровня, который делает исполнение невозможным,
- при победе подписывать контракт вовремя,
- корректно вести документы и коммуникацию по исполнению.

Главная причина проблем — разрыв между обещанием в заявке и реальной способностью исполнить контракт.''',
        'metadata': {'topic': 'control_and_risks', 'section': 'rnp_practice', 'role': 'supplier'}
    },
    {
        'chunk_id': 'kb_customer_risks_from_bad_supplier',
        'text': '''Для заказчика ключевой риск — выбрать поставщика, который не сможет исполнить контракт.
Это приводит к:
- срыву потребности,
- необходимости повторной закупки,
- конфликтам и судебным спорам,
- потере времени и ресурсов.

Поэтому заказчик стремится балансировать конкуренцию и качество требований,
а поставщик должен показывать реальную способность исполнить обязательства.''',
        'metadata': {'topic': 'control_and_risks', 'section': 'customer_risks', 'role': 'customer'}
    },
    {
        'chunk_id': 'kb_grounded_answers_principle',
        'text': '''Принцип "grounded" ответа: если агент выдаёт цифры и выводы, они должны опираться на:
- результаты API и метрик (данные),
- конкретные правила расчёта (база знаний),
- примеры регномеров (`reg_numbers`) как основания.

Если агент отвечает на справочный вопрос без API, он должен ссылаться на базу знаний
и избегать утверждений, которые выглядят как точные числа без источника.''',
        'metadata': {'topic': 'control_and_risks', 'section': 'groundedness'}
    },
    {
        'chunk_id': 'kb_glossary_nmc',
        'text': '''Глоссарий: НМЦК.
НМЦК (начальная максимальная цена контракта) — это ориентир цены, который заказчик устанавливает при публикации закупки.
НМЦК влияет на:
- ожидания участников по цене,
- уровень конкуренции,
- финансовую привлекательность закупки.

В аналитике контрактов важно не путать:
- НМЦК (стартовая цена закупки),
- фактические суммы по контрактам (то, что отражено в агрегатах контрактов).''',
        'metadata': {'topic': 'control_and_risks', 'section': 'glossary'}
    },
    {
        'chunk_id': 'kb_glossary_security',
        'text': '''Глоссарий: обеспечение.
Обеспечение заявки или исполнения контракта — финансовая гарантия, которая снижает риск срыва обязательств.
Для поставщика обеспечение:
- замораживает часть средств,
- повышает стоимость участия,
- создаёт риск потерь при нарушениях.

Для заказчика обеспечение — способ снизить вероятность участия "случайных" или недобросовестных участников.''',
        'metadata': {'topic': 'control_and_risks', 'section': 'glossary'}
    },
    {
        'chunk_id': 'kb_glossary_protocol',
        'text': '''Глоссарий: протокол.
Протокол — официальный документ, фиксирующий решения комиссии и результаты этапов процедуры.
Протоколы важны для:
- понимания, почему отклонили заявку,
- подтверждения победителя,
- обжалования действий заказчика.

Для аналитики протоколы напрямую не используются, но их логика отражается в этапах закупки (status).''',
        'metadata': {'topic': 'control_and_risks', 'section': 'glossary'}
    },
    {
        'chunk_id': 'kb_glossary_application',
        'text': '''Глоссарий: заявка.
Заявка — пакет сведений и документов, который поставщик подаёт для участия в закупке.
Ошибки в заявке ведут к:
- отклонению на комиссии,
- потере времени,
- снижению эффективности участия.

Даже сильный поставщик может проиграть из-за формальных ошибок,
поэтому качество заявки — один из главных факторов успеха.''',
        'metadata': {'topic': 'control_and_risks', 'section': 'glossary'}
    },
    {
        'chunk_id': 'kb_glossary_customer_supplier_roles',
        'text': '''Глоссарий: заказчик и поставщик.
Заказчик — инициатор закупки, формирует условия и заключает контракт.
Поставщик — участник, подаёт заявку и исполняет контракт при победе.

В данных проекта эти роли отражаются в counterparty-строках:
- counterparty_role='customer' — агрегаты по заказчикам,
- counterparty_role='supplier' — агрегаты по поставщикам.''',
        'metadata': {'topic': 'control_and_risks', 'section': 'glossary'}
    },
    {
        'chunk_id': 'kb_glossary_currency',
        'text': '''Глоссарий: валюта.
В аналитике контрактов валюта определяет, какие суммы можно сравнивать и агрегировать.
Правило проекта:
- суммы разных валют не смешиваются,
- totals и топы считаются по выбранной `main_currency`.

Если пользователь видит несколько валют, корректный вывод — показывать суммы отдельно,
а графики строить по одной валюте (обычно RUB).''',
        'metadata': {'topic': 'control_and_risks', 'section': 'glossary'}
    },
    {
        'chunk_id': 'kb_why_evidence_reg_numbers_needed',
        'text': '''В аналитическом ответе важно давать "основания" — примеры, которые подтверждают выводы.
В проекте роль оснований выполняют `reg_numbers` (регномера контрактов) из counterparty-строк.

Это полезно потому что:
- пользователь может проверить конкретные контракты по регномерам,
- выводы становятся прозрачнее,
- уменьшается ощущение "модель придумала".

При этом `reg_numbers` — это примеры, а не полный перечень всех контрактов.''',
        'metadata': {'topic': 'control_and_risks', 'section': 'evidence'}
    },
    {
        'chunk_id': 'kb_how_to_read_top_counterparties_correctly',
        'text': '''Топ заказчиков/поставщиков в метриках — это рейтинг контрагентов по сумме (`amount`)
в выбранной `main_currency`.

Как правильно читать топ:
- это агрегаты по контрагентам, а не один контракт;
- один контрагент может иметь несколько регномеров;
- топы не суммируются с totals напрямую (разные типы строк);
- если роль фильтруется, топ отражает только выбранную роль.

Топы полезны для выявления концентрации: кто основные заказчики или поставщики в портфеле.''',
        'metadata': {'topic': 'control_and_risks', 'section': 'analytics_interpretation'}
    },
    {
        'chunk_id': 'kb_interpret_by_year_metric',
        'text': '''Метрика `by_year` показывает динамику суммы и количества контрактов по годам
в выбранной `main_currency`. Она строится только по total-строкам.

Интерпретация:
- рост суммы по годам может означать расширение закупочной активности,
- падение суммы может быть следствием снижения бюджета, смены стратегии или неполных данных,
- количество и сумма могут расходиться: больше контрактов не всегда значит больше денег.

Всегда проверяйте, по какой валюте построен график, и какие фильтры применены.''',
        'metadata': {'topic': 'control_and_risks', 'section': 'metrics_interpretation'}
    },
    {
        'chunk_id': 'kb_interpret_by_status_metric',
        'text': '''Метрика `by_status` показывает распределение суммы и количества по этапам закупки
в выбранной `main_currency`. Она строится только по total-строкам.

Интерпретация:
- высокая доля 'Закупка завершена' означает, что большая часть объёма дошла до финального этапа,
- высокая доля 'Подача заявок' означает много активных закупок "в процессе",
- высокая доля 'Закупка отменена' может указывать на нестабильность или контрольные события.

Корректные выводы всегда должны учитывать период (years) и фильтры.''',
        'metadata': {'topic': 'control_and_risks', 'section': 'metrics_interpretation'}
    },
]
